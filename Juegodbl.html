<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Selecciona imagen .webp</title>
  <style>
    :root{--bg:#0b1220;--card:#07121a;--accent:#3db39e;--muted:#9fb3b0}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    body{display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#071223 0%,#0b1220 100%);color:#e6eef8;padding:24px}
    .wrap{width:100%;max-width:980px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.6)}
    h1{margin:0 0 12px 0;font-size:18px}
    .grid{display:flex;gap:16px}
    .thumbs{display:flex;flex-direction:column;gap:12px;width:320px}
    .thumb-list{display:flex;flex-wrap:wrap;gap:8px}
    .thumb{width:96px;height:96px;overflow:hidden;border-radius:8px;cursor:pointer;border:2px solid transparent;display:flex;align-items:center;justify-content:center;background:var(--card)}
    .thumb img{max-width:100%;max-height:100%;object-fit:contain}
    .thumb.selected{border-color:var(--accent);box-shadow:0 6px 18px rgba(61,179,158,0.16)}
    .preview{flex:1;display:flex;flex-direction:column;gap:12px}
    .preview-box{background:rgba(255,255,255,0.02);border-radius:10px;padding:12px;display:flex;align-items:center;justify-content:center;min-height:320px}
    .preview-box img{max-width:100%;max-height:76vh;object-fit:contain;border-radius:6px}
    .controls{display:flex;gap:8px;align-items:center}
    button{background:var(--accent);color:#05221a;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .meta{font-size:13px;color:var(--muted)}
    @media (max-width:820px){.grid{flex-direction:column}.thumbs{width:100%;flex-direction:row;justify-content:center}.thumb{width:84px;height:84px}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Elige una imagen (.webp)</h1>
    <div class="grid">
      <div class="thumbs">
        <div class="meta">Miniaturas</div>
        <div class="thumb-list" id="thumbList">
          <!-- Thumbnails injected by JS -->
        </div>
      </div>

      <div class="preview">
        <div class="meta">Vista previa</div>
        <div class="preview-box" id="previewBox">
          <span id="noSelection">Selecciona una miniatura para verla aquí</span>
        </div>
        <div class="controls">
          <button id="confirmBtn" disabled>Confirmar selección</button>
          <button id="openBtn" class="ghost" disabled>Abrir en nueva pestaña</button>
          <button id="resetBtn" class="ghost">Reset</button>
          <div style="flex:1"></div>
          <div class="meta">Presiona la miniatura o usa Enter para seleccionar</div>
        </div>
      </div>
    </div>
  </div>

  <script>
  // Lista de imágenes .webp presentes en el proyecto
  const images = [
    'DBL15-06S.webp',
    'DBL-EVT-19S.webp'
  ];

  const thumbList = document.getElementById('thumbList');
  const previewBox = document.getElementById('previewBox');
  const confirmBtn = document.getElementById('confirmBtn');
  const openBtn = document.getElementById('openBtn');
  const noSelection = document.getElementById('noSelection');

  let selectedIndex = -1;

  function createThumb(src, i){
    const div = document.createElement('div');
    div.className = 'thumb';
    div.tabIndex = 0;
    const img = document.createElement('img');
    img.src = src;
    img.alt = src;
    img.loading = 'lazy';
    div.appendChild(img);

    div.addEventListener('click', () => select(i));
    div.addEventListener('keydown', (e)=>{ if(e.key==='Enter') select(i); });
    return div;
  }

  function select(i){
    // update thumbs
    const children = Array.from(thumbList.children);
    children.forEach((c, idx)=> c.classList.toggle('selected', idx===i));
    selectedIndex = i;
    showPreview(images[i]);
    confirmBtn.disabled = false;
    openBtn.disabled = false;
  }

  function showPreview(src){
    previewBox.innerHTML = '';
    const img = document.createElement('img');
    img.src = src;
    img.alt = src;
    previewBox.appendChild(img);
  }

  function init(){
    // add thumbs
    images.forEach((p,i)=>{
      const t = createThumb(p,i);
      thumbList.appendChild(t);
    });
    // keyboard: left/right to change selection
    window.addEventListener('keydown', (e)=>{
      if(e.key==='ArrowRight' || e.key==='ArrowDown'){
        const next = Math.min(images.length-1, (selectedIndex<0?0:selectedIndex+1)); select(next);
      } else if(e.key==='ArrowLeft' || e.key==='ArrowUp'){
        const prev = Math.max(0, (selectedIndex<0?images.length-1:selectedIndex-1)); select(prev);
      }
    });

    confirmBtn.addEventListener('click', ()=>{
      if(selectedIndex<0) return;
      const chosen = images[selectedIndex];
      // Guardar selección y navegar a la página donde están las dos imágenes
      try{
        localStorage.setItem('juegodbl_selected', chosen);
      }catch(e){
        // si no se puede usar localStorage, enviar por query param
      }
      // navegar a la página que muestra ambas imágenes
      window.location.href = 'Juegodbl_result.html';
    });

    openBtn.addEventListener('click', ()=>{
      if(selectedIndex<0) return;
      window.open(images[selectedIndex], '_blank');
    });

    document.getElementById('resetBtn').addEventListener('click', ()=>{
      try{
        localStorage.removeItem('juegodbl_selected');
        localStorage.removeItem('juegodbl_character');
        localStorage.removeItem('juegodbl_locked');
      }catch(e){}
      location.reload();
    });
  }

  // Verify images exist (graceful fallback)
  function checkImagesThenInit(){
    const checks = images.map(src=> fetch(src, {method:'HEAD'}).then(r=> r.ok).catch(()=>false));
    Promise.all(checks).then(results=>{
      const available = results.reduce((acc,ok,i)=> ok ? acc.concat(images[i]) : acc, []);
      if(available.length < 2){
        // if some not found, filter images and continue
        for(let i=images.length-1;i>=0;i--) if(!results[i]) images.splice(i,1);
      }
      if(images.length===0){
        previewBox.innerHTML = '<div class="meta">No se encontraron imágenes .webp en el servidor.</div>';
        return;
      }
      init();
    });
  }

  checkImagesThenInit();
  </script>
</body>
</html>
